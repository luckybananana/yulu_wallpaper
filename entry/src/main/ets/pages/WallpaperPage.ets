import { router } from '@kit.ArkUI';
import { promptAction } from '@kit.ArkUI';
import { QuoteDataManager, Quote } from '../common/QuoteDataManager';

/**
 * Ë∑ØÁî±ÂèÇÊï∞Êé•Âè£
 */
interface RouterParams {
  index?: number;
  quote?: Quote;
}

/**
 * ÊñáÂ≠óÊ†∑ÂºèÊé•Âè£
 */
interface TextStyle {
  fontSize: number;
  lineHeight: number;
}

/**
 * Â£ÅÁ∫∏È¢ÑËßàÈ°µÈù¢
 * Âü∫‰∫éwallpaper.htmlÂÆûÁé∞Â£ÅÁ∫∏È¢ÑËßà„ÄÅCanvasÁªòÂà∂ÂàÜÂ±ÇÊ≥¢Êµ™ËÉåÊôØ„ÄÅËß¶Êë∏ÊªëÂä®ÂàáÊç¢ËØ≠ÂΩïÁ≠âÂäüËÉΩ
 */
@Entry
@Component
struct WallpaperPage {
  // È°µÈù¢Áä∂ÊÄÅ
  @State quotes: Quote[] = [];
  @State currentQuoteIndex: number = 0;
  @State isControlsVisible: boolean = true;
  @State isLoading: boolean = true;
  @State isShareVisible: boolean = false;
  @State shareState: 'confirm' | 'loading' | 'success' = 'confirm';
  
  // Ëß¶Êë∏Áõ∏ÂÖ≥Áä∂ÊÄÅ
  @State touchStartX: number = 0;
  @State touchStartY: number = 0;
  
  // CanvasÁõ∏ÂÖ≥
  private canvasContext?: CanvasRenderingContext2D;
  private canvasWidth: number = 0;
  private canvasHeight: number = 0;
  
  // ÊúçÂä°ÂÆû‰æã
  private quoteManager = QuoteDataManager.getInstance(getContext(this));

  /**
   * È°µÈù¢ÂàùÂßãÂåñ
   */
  async aboutToAppear() {
    console.log('Â£ÅÁ∫∏È¢ÑËßàÁïåÈù¢Âä†ËΩΩÂÆåÊàê');
    await this.loadQuotes();
    this.initializeIndex();
  }

  /**
   * Âä†ËΩΩËØ≠ÂΩïÊï∞ÊçÆ
   */
  async loadQuotes() {
    try {
      this.quotes = await this.quoteManager.getAllQuotes();
      console.log('ËØ≠ÂΩïÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê:', this.quotes.length, 'Êù°');
      
      // Â¶ÇÊûúÊ≤°ÊúâËØ≠ÂΩïÔºå‰ΩøÁî®ÈªòËÆ§ËØ≠ÂΩï
      if (this.quotes.length === 0) {
        const defaultQuote: Quote = {
          id: 'default',
          text: 'ÁîüÊ¥ª‰∏çÊòØÁ≠âÂæÖÈ£éÊö¥ËøáÂéªÔºåËÄåÊòØÂ≠¶‰ºöÂú®Èõ®‰∏≠Áø©Áø©Ëµ∑Ëàû„ÄÇ',
          tags: [],
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        this.quotes = [defaultQuote];
      }
      
      this.isLoading = false;
      
      // Êï∞ÊçÆÂä†ËΩΩÂÆåÊàêÂêéÈáçÁªòCanvas
      setTimeout(() => {
        if (this.canvasContext) {
          this.drawLayeredWaves('#4A90E2');
        }
      }, 200);
    } catch (error) {
      console.error('Âä†ËΩΩËØ≠ÂΩïÂ§±Ë¥•:', error);
      // ‰ΩøÁî®ÈªòËÆ§ËØ≠ÂΩï‰Ωú‰∏∫Â§áÈÄâ
      const defaultQuote: Quote = {
        id: 'default',
        text: 'ÁîüÊ¥ª‰∏çÊòØÁ≠âÂæÖÈ£éÊö¥ËøáÂéªÔºåËÄåÊòØÂ≠¶‰ºöÂú®Èõ®‰∏≠Áø©Áø©Ëµ∑Ëàû„ÄÇ',
        tags: [],
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      this.quotes = [defaultQuote];
      this.isLoading = false;
      
      // Êï∞ÊçÆÂä†ËΩΩÂÆåÊàêÂêéÈáçÁªòCanvas
      setTimeout(() => {
        if (this.canvasContext) {
          this.drawLayeredWaves('#4A90E2');
        }
      }, 200);
    }
  }

  /**
   * ÂàùÂßãÂåñÁ¥¢Âºï
   */
  initializeIndex() {
    const params = router.getParams() as RouterParams;
    if (params) {
      // ‰ºòÂÖà‰ΩøÁî®‰º†ÈÄíÁöÑquoteÂèÇÊï∞
      if (params.quote) {
        const quoteIndex = this.quotes.findIndex(q => q.id === params.quote!.id);
        if (quoteIndex >= 0) {
          this.currentQuoteIndex = quoteIndex;
        } else {
          // Â¶ÇÊûúÊ≤°ÊâæÂà∞ÂØπÂ∫îÁöÑquoteÔºåÂ∞Ü‰º†ÈÄíÁöÑquoteÊ∑ªÂä†Âà∞ÂàóË°®ÂºÄÂ§¥
          this.quotes.unshift(params.quote);
          this.currentQuoteIndex = 0;
        }
      } else if (typeof params.index === 'number' && 
                 params.index >= 0 && params.index < this.quotes.length) {
        this.currentQuoteIndex = params.index;
      }
    }
  }

  /**
   * ÂçÅÂÖ≠ËøõÂà∂È¢úËâ≤ËΩ¨RGB
   */
  private hexToRgb(hex: string): number[] {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? [
      parseInt(result[1], 16),
      parseInt(result[2], 16),
      parseInt(result[3], 16)
    ] : [0, 0, 0];
  }

  /**
   * Ë∞ÉÊï¥È¢úËâ≤‰∫ÆÂ∫¶Ôºà‰∏éwallpaper.htmlÁöÑadjustColorÂáΩÊï∞‰øùÊåÅ‰∏ÄËá¥Ôºâ
   */
  private adjustColor(rgb: number[], factor: number = 1.0): number[] {
    const r = rgb[0];
    const g = rgb[1];
    const b = rgb[2];
    return [
      Math.max(0, Math.min(255, Math.floor(r * factor))),
      Math.max(0, Math.min(255, Math.floor(g * factor))),
      Math.max(0, Math.min(255, Math.floor(b * factor)))
    ];
  }

  /**
   * ÁªòÂà∂ÂàÜÂ±ÇÊ≥¢Êµ™ËÉåÊôØÔºà‰∏éwallpaper.htmlÁöÑdrawLayeredWavesÂáΩÊï∞‰øùÊåÅ‰∏ÄËá¥Ôºâ
   */
  private drawLayeredWaves(baseColor: string) {
    if (!this.canvasContext || this.canvasWidth === 0 || this.canvasHeight === 0) return;
    
    const ctx = this.canvasContext;
    const width = this.canvasWidth;
    const height = this.canvasHeight;
    const baseRgb = this.hexToRgb(baseColor);
    
    // Ê∏ÖÁ©∫ÁîªÂ∏É
    ctx.clearRect(0, 0, width, height);
    
    // ÂèÇÊï∞ËÆæÁΩÆÔºà‰∏éwallpaper.html‰øùÊåÅ‰∏ÄËá¥Ôºâ
    const numLayers = 6;
    const baseFromBottom = Math.floor(height * 0.32);
    const gapPerLayer = Math.floor(height * 0.035);
    const baseWavelength = 420;
    const baseAmplitude = 52;
    const step = 6;
    
    // ÁªòÂà∂6Â±ÇÊ≥¢Êµ™Ôºà‰ªé‰∏äÂà∞‰∏ãÔºåÈ¢úËâ≤ÈÄêÊ∏êÂä†Ê∑±Ôºâ
    for (let i = 0; i < numLayers; i++) {
      // È¢úËâ≤Ë∞ÉÊï¥Ôºà‰∏éwallpaper.htmlÁöÑadjust_colorÈÄªËæë‰∏ÄËá¥Ôºâ
      const colorFactor = 1 - i * 0.06;
      const adjustedRgb = this.adjustColor(baseRgb, colorFactor);
      
      // ÈÄèÊòéÂ∫¶ËÆ°ÁÆóÔºà‰∏éwallpaper.html‰∏ÄËá¥Ôºö25 + i*38ÔºåËΩ¨Êç¢‰∏∫0-1ËåÉÂõ¥Ôºâ
      const alpha = Math.min(255, 25 + i * 38) / 255;
      
      ctx.fillStyle = `rgba(${adjustedRgb[0]}, ${adjustedRgb[1]}, ${adjustedRgb[2]}, ${alpha})`;
      
      // Ê≥¢Êµ™ÂèÇÊï∞Ôºà‰∏éwallpaper.html‰∏ÄËá¥Ôºâ
      const wavelength = baseWavelength * (1.0 + i * 0.03);
      const amplitude = baseAmplitude * (1.0 + i * 0.05);
      const phase = Math.random() * Math.PI * 2; // ÈöèÊú∫Áõ∏‰Ωç
      
      // Â±ÇÂÅèÁßªËÆ°ÁÆóÔºà‰∏éwallpaper.html‰∏ÄËá¥Ôºâ
      const layerOffset = height - (baseFromBottom - i * gapPerLayer);
      
      // ÂàõÂª∫Ê≥¢Êµ™Ë∑ØÂæÑ
      ctx.beginPath();
      
      // ÁªòÂà∂Ê≠£Âº¶Ê≥¢Ôºà‰∏éwallpaper.htmlÈÄªËæë‰∏ÄËá¥Ôºâ
      const points: number[][] = [];
      for (let x = 0; x <= width; x += step) {
        const y = layerOffset - amplitude * Math.sin(2 * Math.PI * x / wavelength + phase);
        points.push([x, y]);
      }
      
      // ÂºÄÂßãÁªòÂà∂Ë∑ØÂæÑ
      if (points.length > 0) {
        ctx.moveTo(points[0][0], points[0][1]);
        for (let j = 1; j < points.length; j++) {
          ctx.lineTo(points[j][0], points[j][1]);
        }
      }
      
      // Â∞ÅÈó≠Ë∑ØÂæÑÂà∞Â∫ïÈÉ®Ôºà‰∏éwallpaper.html‰∏ÄËá¥Ôºâ
      ctx.lineTo(width, height);
      ctx.lineTo(0, height);
      ctx.closePath();
      ctx.fill();
    }
  }

  /**
   * Ê†πÊçÆÂ≠óÊï∞Ëá™Âä®Ë∞ÉÊï¥ÊñáÂ≠óÊ†∑Âºè
   */
  private getTextStyle(content: string): TextStyle {
    const length = content.length;
    
    if (length <= 15) {
      const style: TextStyle = { fontSize: 28, lineHeight: 1.4 };
      return style;
    } else if (length <= 30) {
      const style: TextStyle = { fontSize: 24, lineHeight: 1.5 };
      return style;
    } else if (length <= 50) {
      const style: TextStyle = { fontSize: 20, lineHeight: 1.6 };
      return style;
    } else {
      const style: TextStyle = { fontSize: 18, lineHeight: 1.7 };
      return style;
    }
  }

  /**
   * ÂàáÊç¢Âà∞ÊåáÂÆöËØ≠ÂΩï
   */
  private switchToQuote(index: number) {
    if (index < 0 || index >= this.quotes.length) return;
    
    this.currentQuoteIndex = index;
    // ÈáçÊñ∞ÁªòÂà∂Ê≥¢Êµ™ËÉåÊôØ
    setTimeout(() => {
      if (this.quotes[index]) {
        this.drawLayeredWaves('#4A90E2');
      }
    }, 50);
  }

  /**
   * ‰∏ä‰∏ÄÊù°ËØ≠ÂΩï
   */
  private previousQuote() {
    const newIndex = this.currentQuoteIndex > 0 ? this.currentQuoteIndex - 1 : this.quotes.length - 1;
    this.switchToQuote(newIndex);
  }

  /**
   * ‰∏ã‰∏ÄÊù°ËØ≠ÂΩï
   */
  private nextQuote() {
    const newIndex = this.currentQuoteIndex < this.quotes.length - 1 ? this.currentQuoteIndex + 1 : 0;
    this.switchToQuote(newIndex);
  }

  /**
   * ÂàáÊç¢ÊéßÂà∂Ê†èÊòæÁ§∫/ÈöêËóè
   */
  private toggleControls() {
    this.isControlsVisible = !this.isControlsVisible;
  }

  /**
   * ËøîÂõû‰∏ä‰∏ÄÈ°µ
   */
  private goBack() {
    router.back();
  }

  /**
   * ËÆæÁΩÆÂ£ÅÁ∫∏
   */
  private setWallpaper() {
    console.log('ËÆæÁΩÆÂ£ÅÁ∫∏:', this.quotes[this.currentQuoteIndex]);
    
    promptAction.showToast({
      message: 'Ê≠£Âú®ËÆæÁΩÆÂ£ÅÁ∫∏...',
      duration: 2000
    });
    
    setTimeout(() => {
      promptAction.showToast({
        message: 'Â£ÅÁ∫∏ËÆæÁΩÆÊàêÂäüÔºÅ',
        duration: 2000
      });
    }, 2000);
  }

  /**
   * ÁºñËæëËØ≠ÂΩï
   */
  private editQuote() {
    const quote = this.quotes[this.currentQuoteIndex];
    router.pushUrl({
      url: 'pages/EditPage',
      params: {
        mode: 'edit',
        quote: quote
      }
    });
  }

  /**
   * ÂàÜ‰∫´Â£ÅÁ∫∏
   */
  private shareWallpaper() {
    this.isShareVisible = true;
    this.shareState = 'confirm';
  }

  /**
   * ÂÖ≥Èó≠ÂàÜ‰∫´ÈÅÆÁΩ©
   */
  private closeShareOverlay() {
    this.isShareVisible = false;
    this.shareState = 'confirm';
  }

  /**
   * Á°ÆËÆ§ÂàÜ‰∫´
   */
  private confirmShare() {
    this.shareState = 'loading';
    
    // Ê®°ÊãüÁîüÊàêËøáÁ®ã
    setTimeout(() => {
      this.shareState = 'success';
    }, 2000);
  }

  /**
   * Ë∞ÉÁî®Á≥ªÁªüÂàÜ‰∫´
   */
  private callSystemShare() {
    console.log('Ë∞ÉÁî®Á≥ªÁªüÂàÜ‰∫´Èù¢Êùø');
    promptAction.showToast({
      message: 'Ë∞ÉÁî®Á≥ªÁªüÂàÜ‰∫´Èù¢Êùø',
      duration: 2000
    });
    this.closeShareOverlay();
  }

  /**
   * ÊûÑÂª∫È°µÈù¢UI
   */
  build() {
    Stack() {
      // ‰∏ªÈ¢ÑËßàÂÆπÂô®
      Column() {
        // CanvasËÉåÊôØ
        Canvas(this.canvasContext)
          .width('100%')
          .height('100%')
          .backgroundColor('#E6E6E6') // ‰∏éwallpaper.html‰øùÊåÅ‰∏ÄËá¥
          .onReady(() => {
            // Ëé∑ÂèñCanvasÂ∞∫ÂØ∏
            this.canvasWidth = 360; // Ê†πÊçÆÂÆûÈôÖÂÆπÂô®ÂÆΩÂ∫¶Ë∞ÉÊï¥
            this.canvasHeight = 640; // Ê†πÊçÆÂÆûÈôÖÂÆπÂô®È´òÂ∫¶Ë∞ÉÊï¥
            
            console.log('CanvasÂàùÂßãÂåñÂÆåÊàêÔºåÂ∞∫ÂØ∏:', this.canvasWidth, 'x', this.canvasHeight);
            
            // Âª∂ËøüÁªòÂà∂ÔºåÁ°Æ‰øùÊï∞ÊçÆÂ∑≤Âä†ËΩΩ
            setTimeout(() => {
              if (this.canvasContext && !this.isLoading) {
                console.log('ÂºÄÂßãÁªòÂà∂Ê≥¢Êµ™ËÉåÊôØ');
                this.drawLayeredWaves('#4A90E2');
              }
            }, 100);
          })
          .onAreaChange((oldValue: Area, newValue: Area) => {
            // ÂΩìCanvasÂ∞∫ÂØ∏ÊîπÂèòÊó∂Êõ¥Êñ∞Â∞∫ÂØ∏
            this.canvasWidth = Number(newValue.width);
            this.canvasHeight = Number(newValue.height);
            // ÈáçÊñ∞ÁªòÂà∂
            if (this.canvasContext && !this.isLoading) {
              setTimeout(() => {
                this.drawLayeredWaves('#4A90E2');
              }, 50);
            }
          })
      }
      .width('100%')
      .height('100%')
      .gesture(
        // Ê∑ªÂä†Ëß¶Êë∏ÊâãÂäø
        PanGesture()
          .onActionStart((event) => {
            this.touchStartX = event.fingerList[0].globalX;
            this.touchStartY = event.fingerList[0].globalY;
          })
          .onActionEnd((event) => {
            const touchEndX = event.fingerList[0].globalX;
            const touchEndY = event.fingerList[0].globalY;
            const deltaX = touchEndX - this.touchStartX;
            const deltaY = touchEndY - this.touchStartY;
            
            // Âà§Êñ≠ÊòØÂê¶‰∏∫Ê∞¥Âπ≥ÊªëÂä®
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
              if (deltaX > 0) {
                // ÂêëÂè≥ÊªëÂä® - ‰∏ä‰∏ÄÊù°
                this.previousQuote();
              } else {
                // ÂêëÂ∑¶ÊªëÂä® - ‰∏ã‰∏ÄÊù°
                this.nextQuote();
              }
            }
          })
      )
      .onClick(() => {
        this.toggleControls();
      })

      // ËØ≠ÂΩïÂÜÖÂÆπÂå∫Âüü
      if (!this.isLoading && this.quotes.length > 0) {
        Column() {
          Text(this.quotes[this.currentQuoteIndex]?.text || '')
            .fontSize(this.getTextStyle(this.quotes[this.currentQuoteIndex]?.text || '').fontSize)
            .fontColor('#FFFFFF')
            .textAlign(TextAlign.Center)
            .lineHeight(this.getTextStyle(this.quotes[this.currentQuoteIndex]?.text || '').lineHeight)
            .fontWeight(FontWeight.Medium)
            .padding({ left: 32, right: 32 })
            .shadow({
              radius: 8,
              color: 'rgba(0, 0, 0, 0.3)',
              offsetX: 0,
              offsetY: 2
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.Center)
        .position({ x: 0, y: '40%' })
      }

      // ËøîÂõûÊåâÈíÆ
      Button() {
        Text('‚Üê')
          .fontSize(24)
          .fontColor('#FFFFFF')
      }
      .width(48)
      .height(48)
      .backgroundColor('rgba(0, 0, 0, 0.3)')
      .borderRadius(24)
      .position({ x: 16, y: 48 })
      .onClick(() => this.goBack())

      // ÂØºËà™ÊèêÁ§∫
      if (this.quotes.length > 1) {
        Row() {
          ForEach(this.quotes, (quote: Quote, index: number) => {
            Circle()
              .width(8)
              .height(8)
              .fill(index === this.currentQuoteIndex ? '#FFFFFF' : 'rgba(255, 255, 255, 0.4)')
              .margin({ left: 4, right: 4 })
          })
        }
        .position({ x: '50%', y: '75%' })
        .translate({ x: '-50%', y: 0 })
      }

      // Â∫ïÈÉ®Êìç‰ΩúÊ†è
      if (this.isControlsVisible) {
        Row() {
          // ËÆæÁΩÆÂ£ÅÁ∫∏ÊåâÈíÆ
          Button() {
            Column() {
              Text('üì±')
                .fontSize(20)
              Text('ËÆæÁΩÆÂ£ÅÁ∫∏')
                .fontSize(12)
                .fontColor('#FFFFFF')
                .margin({ top: 4 })
            }
          }
          .backgroundColor('rgba(0, 0, 0, 0.6)')
          .borderRadius(12)
          .padding(12)
          .onClick(() => this.setWallpaper())

          Blank()

          // ÁºñËæëÊåâÈíÆ
          Button() {
            Column() {
              Text('‚úèÔ∏è')
                .fontSize(20)
              Text('ÁºñËæë')
                .fontSize(12)
                .fontColor('#FFFFFF')
                .margin({ top: 4 })
            }
          }
          .backgroundColor('rgba(0, 0, 0, 0.6)')
          .borderRadius(12)
          .padding(12)
          .onClick(() => this.editQuote())

          Blank()

          // ÂàÜ‰∫´ÊåâÈíÆ
          Button() {
            Column() {
              Text('üì§')
                .fontSize(20)
              Text('ÂàÜ‰∫´')
                .fontSize(12)
                .fontColor('#FFFFFF')
                .margin({ top: 4 })
            }
          }
          .backgroundColor('rgba(0, 0, 0, 0.6)')
          .borderRadius(12)
          .padding(12)
          .onClick(() => this.shareWallpaper())
        }
        .width('100%')
        .padding({ left: 24, right: 24, bottom: 32 })
        .position({ x: 0, y: '100%' })
        .translate({ x: 0, y: '-100%' })
      }

      // ÂàÜ‰∫´ÁîüÊàêÈÅÆÁΩ©
      if (this.isShareVisible) {
        Column() {
          // ÈÅÆÁΩ©ËÉåÊôØ
          Column()
            .width('100%')
            .height('100%')
            .backgroundColor('rgba(0, 0, 0, 0.5)')
            .onClick(() => this.closeShareOverlay())

          // ÂàÜ‰∫´ÂÜÖÂÆπÂç°Áâá
          Column() {
            Text('ÂàÜ‰∫´Â£ÅÁ∫∏')
              .fontSize(18)
              .fontWeight(FontWeight.Medium)
              .fontColor('#333333')
              .margin({ bottom: 16 })

            // È¢ÑËßàÂÜÖÂÆπ
            Column() {
              Text(this.quotes[this.currentQuoteIndex]?.text || '')
                .fontSize(16)
                .fontColor('#333333')
                .textAlign(TextAlign.Center)
                .lineHeight(24)
                .maxLines(4)
                .textOverflow({ overflow: TextOverflow.Ellipsis })
            }
            .width('100%')
            .padding(16)
            .backgroundColor('#F8F9FA')
            .borderRadius(8)
            .margin({ bottom: 20 })

            // Áä∂ÊÄÅÊòæÁ§∫
            if (this.shareState === 'loading') {
              Column() {
                LoadingProgress()
                  .width(32)
                  .height(32)
                  .color('#007AFF')
                Text('Ê≠£Âú®ÁîüÊàêÂàÜ‰∫´ÂõæÁâá...')
                  .fontSize(14)
                  .fontColor('#666666')
                  .margin({ top: 8 })
              }
              .margin({ bottom: 20 })
            } else if (this.shareState === 'success') {
              Column() {
                Text('‚úÖ')
                  .fontSize(32)
                Text('ÁîüÊàêÊàêÂäüÔºÅ')
                  .fontSize(14)
                  .fontColor('#666666')
                  .margin({ top: 8 })
              }
              .margin({ bottom: 20 })
            }

            // Êìç‰ΩúÊåâÈíÆ
            Row() {
              Button('ÂèñÊ∂à')
                .width(80)
                .height(40)
                .fontSize(16)
                .fontColor('#666666')
                .backgroundColor('#F5F5F5')
                .borderRadius(8)
                .onClick(() => this.closeShareOverlay())

              Blank()

              Button(this.shareState === 'loading' ? 'ÁîüÊàê‰∏≠...' : 
                     this.shareState === 'success' ? 'Ë∞ÉÁî®ÂàÜ‰∫´' : 'ÂàÜ‰∫´')
                .width(120)
                .height(40)
                .fontSize(16)
                .fontColor('#FFFFFF')
                .backgroundColor(this.shareState === 'loading' ? '#CCCCCC' : '#007AFF')
                .borderRadius(8)
                .enabled(this.shareState !== 'loading')
                .onClick(() => {
                  if (this.shareState === 'success') {
                    this.callSystemShare();
                  } else {
                    this.confirmShare();
                  }
                })
            }
            .width('100%')
          }
          .width('80%')
          .padding(24)
          .backgroundColor('#FFFFFF')
          .borderRadius(16)
          .position({ x: '50%', y: '50%' })
          .translate({ x: '-50%', y: '-50%' })
        }
        .width('100%')
        .height('100%')
        .position({ x: 0, y: 0 })
      }

      // Âä†ËΩΩÁä∂ÊÄÅ
      if (this.isLoading) {
        Column() {
          LoadingProgress()
            .width(48)
            .height(48)
            .color('#FFFFFF')
          Text('Âä†ËΩΩ‰∏≠...')
            .fontSize(16)
            .fontColor('#FFFFFF')
            .margin({ top: 16 })
        }
        .width('100%')
        .height('100%')
        .backgroundColor('rgba(0, 0, 0, 0.8)')
        .justifyContent(FlexAlign.Center)
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#000000')
  }
}